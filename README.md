# 🤖 复合多AI智能体股票团队分析系统

- 初心：在股市摸爬滚打多年，自学自编各种指标，花冤柉钱学习了各种战法各种策略，也曾入各种小班，总是赚少赔多，逐渐失去在股市玩的信心。自从去年deepseek上市，一直探索用ai辅助分析，且近日受tradingagents项目启发（感谢原作），多agent结合跟踪主力资金战法（某指每年收费6000rmb），用各种ai辅助编程，拼凑了这么个小程序，根据软件提供的辅助信息，实盘测试盈率还是挺高的，并且逐步形成了自己的交易系统，近一个月来，账户也慢慢在扰亏为盈。开源此软件的目的，就是为了使像我一样的小散，不再迷范。也许这个软件不能让你发大财，但是他能给你足够的信心。最后提醒：股市有风险，入市需谨慎！
## QQ交流群：1059277514
## B站本地部署教程1：https://www.bilibili.com/video/BV1qHFPz9EXY/
## docker部署教程2：https://www.bilibili.com/video/BV1j2FNz4EAi/

## ⭐20261.25第一更 - 新闻流量监测 📈

实时监测百度、微博、东财、财联社、抖音、B站等20个平台热点新闻，调用ai分析对A股板块及股票的影响，生成分析报告。也可使用https://stock-news.ws4.cn

## ⭐ 1214更新 - 净利增长策略 📈

新增“净利增长策略”选股板块，专注稳健成长股票：回测年化100%+

**核心功能：**
- ✅ **稳健成长** - 净利润增长率≥10%，稳健可持续
- ✅ **成交优先** - 按成交额由小到大排序，选择低流动性股票
- ✅ **区域聚焦** - 仅限深圳A股，排除科创板和创业板
- ✅ **策略监控** - 自动跟踪持仓，智能提醒卖出
- ✅ **仓位管理** - 资金5万、个股最大4成、单日最多买1股
- ✅ **铉钉通知** - 选股结果和卖出信号自动通知

**使用流程：**
1. 在选股板块中点击“📈 净利增长”
2. 执行选股，查看筛选结果
3. 点击“➕ 加入策略监控”加入监控
4. 在策略监控面板查看卖出提醒

> **注意**：当前监控服务暂时使用MA5下穿MA20作为卖出信号，后续将升级支持KDJ指标。

---

## ⭐ 1214更新 - 小市值策略 📊

新增“小市值策略”选股板块，专注小盘高成长股票：

**核心功能：**
- ✅ **精准筛选** - 总市值≤50亿 + 营收增长率≥10% + 净利润增长率≥100% + 沪深A股
- ✅ **小盘优先** - 按总市值由小到大排序，优选最小盘股票
- ✅ **策略监控** - 复用低价擒牛监控框架，自动跟踪持仓
- ✅ **双重信号** - 持股5天 + MA5下穿MA20智能提醒
- ✅ **仓位管理** - 资金10万、个股最大3成、最多4股
- ✅ **铉钉通知** - 选股结果和卖出信号自动通知

**使用流程：**
1. 在选股板块中点击“📊 小市值策略”
2. 执行选股，查看筛选结果
3. 点击“➕ 加入策略监控”加入监控
4. 在策略监控面板统一管理

---

## ⭐ 1212更新 - 低价擒牛策略监控 🐂

新增“低价擒牛”选股板块，自动监控持仓并智能提醒卖出：

**核心功能：**
- ✅ **智能选股** - 股价<10元 + 净利润增长率≥65100% + 深圳A股
- ✅ **策略监控** - 一键加入监控，自动跟踪持仓股票
- ✅ **双重卖出信号** - 持股满5天自动提醒 + MA5下穿MA20技术信号
- ✅ **实时监控** - 每分钟扫描，集成TDX API获取实时数据
- ✅ **钉钉通知** - 卖出信号自动发送钉钉消息
- ✅ **自动移除** - 触发卖出条件后自动从监控列表移除
- ✅ **历史记录** - 完整的监控历史和提醒记录

**使用流程：**
1. 在选股板块中点击“🐂 低价擒牛”
2. 执行选股，查看筛选结果
3. 点击“➕ 加入策略监控”按钮
4. 进入“📊 策略监控”面板
5. 启动监控服务，等待卖出提醒

**配置说明：**
```bash
# .env文件中添加
TDX_BASE_URL=http://192.168.1.222:8181  # TDX API地址
LOW_PRICE_BULL_SCAN_INTERVAL=60          # 扫描间隔（秒）
LOW_PRICE_BULL_HOLDING_DAYS=5            # 持股天数限制
```

详细说明请查看 [`docs/低价擒牛策略监控配置说明.md`](docs/低价擒牛策略监控配置说明.md)

---
## 新增ai盯盘、实时监测板块获取股票行情引入本地TDX数据源
- 项目地址https://github.com/oficcejo/tdx-api，请按照说明配置（默认docker），默认接口http://宿主机ip：8080
- config.py中配置API接口地址

## 新增按交易时段开启盯盘、监测

## 🤖 新增--AI盯盘 - AI自动化交易决策系统（NEW！）

参照AlphaArena项目，基于 DeepSeek AI 的A股自动化交易系统，支持实时监控、智能决策、自动交易（T+1规则适配）。

**核心功能：**
- ✅ **DeepSeek AI决策** - 利用DeepSeek-V3进行深度技术分析
- ✅ **实时监控** - 24/7持续监控目标股票
- ✅ **自动交易** - 集成miniQMT，支持实盘/模拟交易
- ✅ **T+1规则** - 完全遵循A股交易规则
- ✅ **持仓管理** - 记录持仓成本，实时显示盈亏，AI决策考虑持仓情况 ⭐ NEW
- ✅ **邮件/Webhook通知** - 及时接收交易信号
- ✅ **稳定数据源** - 优化AKShare接口，专注技术面分析 ⭐ 2025-10-25
- ✅ **完整任务流程** - 创建任务后需手动启动，启动/停止自动同步状态，用户完全控制 ⭐ 2025-10-26
- ✅ **K线图可视化** - 交互式K线图，AI决策标注，实时更新，一目了然 ⭐ 2025-10-26 NEW
- ✅ **统一配置** - 使用主程序的配置管理系统（miniQMT、邮件、Webhook）
- ✅ **技术指标完整** - 均线/MACD/RSI/KDJ/布林带，AI决策更可靠

- 希望能帮到你！欢迎加微信讨论(请备注aiagents-stock）



### 基于Python + Streamlit + DeepSeek的智能股票分析系统，模拟证券公司分析师团队，提供全方位的股票投资分析和决策建议。
<img width="1910" height="923" alt="image" src="https://github.com/user-attachments/assets/fe366e1d-2352-46db-a3cc-6f147ee6d9d9" />
<img width="1910" height="923" alt="image" src="https://github.com/user-attachments/assets/112e9e34-381e-4e61-b7b6-6614260b2594" />
<img width="1910" height="923" alt="image" src="https://github.com/user-attachments/assets/46e36075-2f08-4113-bd1d-913ef4dd279c" />
<img width="1910" height="923" alt="image" src="https://github.com/user-attachments/assets/cb3069cc-3cf3-442d-88aa-d4fc756f81eb" />
<img width="1910" height="923" alt="image" src="https://github.com/user-attachments/assets/ff80584a-0599-4891-9b8d-47485fa3678a" />


## ✨1022更新 - 主力选股批量分析修复 🔧

修复了批量分析历史记录功能的关键问题：
- ✅ 修复JSON序列化失败（DataFrame自动转换）
- ✅ 修复历史记录股票名称和评级显示N/A的问题
- ✅ 优化保存性能和错误处理
- ✅ 新增详细调试日志便于追踪

详细修复说明请查看 [`docs/主力选股批量分析修复说明.md`](docs/主力选股批量分析修复说明.md)

---

## ✨1021最新更新 - 主力选股批量分析功能 ⭐️

### 💰 主力选股 - TOP股票批量分析 + 历史记录
在主力选股的候选股票列表中，对主力资金净流入TOP股票提供一键批量深度分析

#### 核心亮点
- **一键批量分析**：可选10/20/30/50只主力资金TOP股票进行深度AI分析
- **双模式支持**：顺序分析（稳定）/ 并行分析（快速）
- **历史记录管理**：自动保存所有批量分析结果，支持查看、统计、重载 ⭐ 新增
- **实时进度追踪**：分析进度可视化显示，状态实时更新
- **快捷加入监测**：分析完成后一键加入实时监测列表
- **完整交易闭环**：主力资金筛选 → AI深度分析 → 历史记录 → 实时监测 → 价格告警

#### 使用场景
- ✅ **主力资金跟踪**：批量分析主力重仓股，跟随聪明资金
- ✅ **资金流向研究**：批量分析TOP50了解主力资金整体流向
- ✅ **精选优质股票**：深度分析TOP10主力最青睐的股票

#### 详细文档
请查看 [`docs/主力选股批量分析功能说明.md`](docs/主力选股批量分析功能说明.md) 获取完整使用指南

---

## ✨1020持仓定时分析功能 ⭐️

### 📊 持仓定时分析系统
专为长期投资者和组合管理打造的智能持仓管理与自动化分析系统

#### 核心功能
- **📝 持仓管理**：可视化管理持仓股票清单
  - 添加/编辑/删除持仓股票
  - 记录成本价、持仓数量、买入备注
  - 支持A股、港股、美股全市场
  
- **🔄 批量分析**：一键分析全部持仓
  - 顺序分析模式：稳定可靠，逐个深度分析
  - 并行分析模式：速度更快，支持3-10线程
  - 实时进度显示，详细结果展示
  
- **⏰ 定时任务**：全自动定时分析（支持多时间点）⭐️
  - **多时间点支持**：可设置多个每日分析时间（如09:25+15:05）
  - 灵活添加/删除时间点，自动排序
  - 后台自动执行，无需人工干预
  - 支持立即执行和手动触发
  - 调度器状态实时监控
  
- **🎯 自动监测同步**：智能联动实时监测
  - 分析完成自动将评级结果同步到监测列表
  - 自动设置进场区间、止盈位、止损位
  - 覆盖同名股票，始终保持最新结果
  
- **📬 通知推送**：及时获取分析报告
  - 邮件通知：HTML精美格式，详细结果展示
  - Webhook通知：钉钉/飞书群消息推送
  - 包含分析概况、同步结果、个股详情
  
- **📈 分析历史**：完整的历史记录追踪
  - 每只股票的历史分析记录
  - 评级变化趋势可视化
  - 验证预测准确性
  - 优化投资决策

#### 使用场景
- ✅ **长期投资者**：每日跟踪持仓，及时调整策略
- ✅ **组合管理**：批量分析多只股票，优化资产配置
- ✅ **自动化交易**：联动监测和量化交易，实现全自动化
- ✅ **策略回测**：历史记录对比实际走势，验证有效性

#### 技术实现
- **数据库**：SQLite持久化存储（portfolio_stocks, portfolio_analysis_history）
- **批量分析**：复用AI智能体团队，支持顺序/并行模式
- **定时调度**：schedule库实现多时间点调度管理
- **监测集成**：批量API无缝对接实时监测系统
- **通知扩展**：专用通知模板，邮件/Webhook双通道
- **统一规范**：强制使用统一的分析函数和字段名，确保代码复用和一致性

#### 快速开始
```bash
# 安装依赖
pip install schedule

# 启动应用
streamlit run app.py

# 点击侧边栏"📊 持仓分析"进入功能
```

#### 详细文档
请查看 [`docs/PORTFOLIO_USAGE.md`](docs/PORTFOLIO_USAGE.md) 获取完整使用指南

---

### 🎯 智瞰龙虎 - TOP股票批量分析功能 ⭐️

在AI评分排名中，对TOP10综合评分股票提供一键批量深度分析

#### 核心功能
- **一键批量分析**：可选3只/5只/10只TOP股票进行深度分析
- **双模式支持**：顺序分析（稳定）/ 并行分析（快速）
- **实时进度追踪**：分析进度可视化显示
- **详细结果展示**：完整的AI分析报告和投资决策
- **快捷加入监测**：分析完成后一键加入实时监测列表
- **遵循统一规范**：使用统一的分析函数和字段名，确保结果一致性

#### 使用流程
```
智瞰龙虎 → AI评分排名 → 查看TOP10 
→ 选择分析数量(3/5/10) → 🚀 开始批量分析 
→ 选择模式(顺序/并行) → 确认开始
→ ⏳ 实时进度显示 → ✅ 分析完成
→ 查看详细结果 → ➕ 加入监测
```

#### 使用场景
- ✅ **短线交易**：龙虎榜筛选 → AI深度分析 → 实时监测 → 价格告警
- ✅ **游资跟踪**：快速批量分析TOP游资操作的股票
- ✅ **题材捕捉**：批量分析热点题材龙头股
- ✅ **完整闭环**：从筛选到分析到监测的一站式解决方案

#### 详细文档
请查看 [`docs/LONGHUBANG_BATCH_ANALYSIS.md`](docs/LONGHUBANG_BATCH_ANALYSIS.md) 获取完整使用指南

---

### 💰 主力选股 - TOP股票批量分析功能 ⭐️新增

在主力选股的候选股票列表中，对主力资金净流入TOP股票提供一键批量深度分析

#### 核心功能
- **一键批量分析**：可选10只/20只/30只/50只主力资金TOP股票进行深度分析
- **双模式支持**：顺序分析（稳定）/ 并行分析（快速）
- **实时进度追踪**：分析进度可视化显示
- **详细结果展示**：完整的AI分析报告和投资决策
- **快捷加入监测**：分析完成后一键加入实时监测列表
- **遵循统一规范**：使用统一的分析函数和字段名，确保结果一致性

#### 使用流程
```
主力选股 → 候选股票列表（按主力资金排序）
→ 选择分析数量(10/20/30/50) → 🚀 开始批量分析 
→ 选择模式(顺序/并行) → 确认开始
→ ⏳ 实时进度显示 → ✅ 分析完成
→ 查看详细结果 → ➕ 加入监测
```

#### 使用场景
- ✅ **主力资金跟踪**：主力选股筛选 → 批量深度分析 → 实时监测 → 价格告警
- ✅ **资金流向研究**：批量分析TOP50了解主力资金整体流向
- ✅ **精选优质股票**：深度分析TOP10主力最青睐的股票
- ✅ **完整闭环**：从主力资金筛选到分析到监测的一站式解决方案

#### 详细文档

- [`docs/主力选股批量分析功能说明.md`](docs/主力选股批量分析功能说明.md) - 批量分析使用指南
- [`docs/主力选股批量分析历史记录功能说明.md`](docs/主力选股批量分析历史记录功能说明.md) - 历史记录功能 ⭐

---

## ✨1019 更新说明

### 🎯 风险管理师功能增强 ⭐️
- **深度风险数据采集**：集成pywencai获取多维度风险信息
  - 📅 限售解禁数据：解禁时间、解禁数量、解禁市值
  - 📉 大股东减持公告：减持计划、实施进度、股东身份
  - ⚠️ 重要事件追踪：重大事项、经营变动、监管关注
- **完整数据传递**：深度解析风险细节
  - 时间维度：解禁/减持的时间节点分析
  - 规模维度：涉及金额和数量的量化评估
  - 频率维度：事件发生频率和密集度判断
  - 主体维度：股东身份和意图识别
- **智能风险评估**：AI对原始风险数据进行深度解析和综合研判
- **数据可靠性提升**：优化数据获取和格式化逻辑，自动处理嵌套数据结构

### 🔧 批量分析功能优化
- **修复重复数据获取**：解决批量分析完成后重新获取数据的问题
- **结果展示优化**：修复批量分析结果不显示的bug
- **表格渲染优化**：移除pandas样式依赖，提升渲染稳定性和速度
- **状态管理优化**：改进session_state管理，确保结果正确显示

## ✨1017 更新说明

### 🎯 智瞰龙虎板块分析系统 ⭐️ 全新上线

#### 核心功能
- **龙虎榜深度分析**：基于StockAPI龙虎榜接口，获取游资上榜交割单数据
- **5位AI分析师团队**：
  - 🎯 游资行为分析师：识别活跃游资及其操作风格
  - 📈 个股潜力分析师：挖掘次日大概率上涨的潜力股（核心）
  - 🔥 题材追踪分析师：识别热点题材和炒作周期
  - ⚠️ 风险控制专家：识别高风险股票和资金陷阱
  - 👔 首席策略师：综合研判，给出最终推荐股票清单

#### 最新更新：TOP股票批量分析 ⭐️
- **一键批量分析**：对AI评分排名TOP10股票进行深度分析
  - 可选分析数量：3只/5只/10只
  - 顺序/并行分析模式
  - 实时进度显示
  - 详细结果展示
- **快捷加入监测**：分析完成后一键加入实时监测列表
- **遵循统一规范**：使用统一的分析函数和字段名
- **完整交易闭环**：龙虎榜筛选 → AI深度分析 → 实时监测 → 价格告警

#### 传统功能
- **次日上涨股票预测**：AI识别大概率上涨的股票
- **游资追踪**：跟踪知名游资（赵老哥、章盟主等）的操作
- **题材识别**：发现热点题材和龙头股
- **风险提示**：识别游资出货和高风险陷阱
- **历史报告** ⭐️ 增强版：
  - 完整的分析结果保存（AI分析师报告、评分排名、推荐股票）
  - 可展开查看每条历史报告的详细内容
  - 支持重新加载历史报告到分析页面
  - 结构化数据存储，便于追溯和分析
- **PDF报告**：生成专业的分析报告

#### 数据可视化
- 资金净流入TOP20图表
- 热门概念分布图
- 活跃游资排名表
- AI评分排名表 ⭐️

#### 使用场景
- 短线交易机会挖掘
- 游资龙头股追踪
- 热点题材捕捉
- 风险规避

#### 数据来源
StockAPI龙虎榜接口（每日更新，免费1000次）

<img width="1910" height="923" alt="智瞰龙虎界面" src="https://github.com/user-attachments/assets/longhubang_ui.png" />

## ✨1015 更新说明

### 🎯 智策板块分析系统 ⭐️
- **多AI智能体协同**：四位专业分析师团队协同工作
  - 🌐 宏观策略师：分析经济政策、新闻事件
  - 📊 板块诊断师：分析板块走势、估值、轮动
  - 💰 资金流向分析师：跟踪主力资金、北向资金
  - 📈 市场情绪解码员：量化市场情绪、识别热点
- **三维度预测体系**：
  - 板块多空预测：看多/看空板块推荐（含信心度）
  - 板块轮动预测：强势/潜力/衰退板块判断
  - 板块热度排行：最热/升温/降温板块TOP榜
- **定时分析功能** ⭐️：
  - 每日自动运行分析，无需手动触发
  - 支持邮件+Webhook双通道推送
  - 灵活设置运行时间（盘前/盘后/晚间）
  - 手动触发和状态监控
- **数据来源**：AKShare免费数据（行情、资金、新闻）
- **AI模型**：DeepSeek Chat / Reasoner双模型
- **报告导出**：支持PDF格式完整报告
- **使用场景**：盘前策略、板块轮动、风险规避

<img width="1910" height="923" alt="智策板块分析界面" src="https://github.com/user-attachments/assets/sector_strategy_ui.png" />

### 🔔 新增Webhook通知功能 ⭐️
- **多平台支持**：支持钉钉、飞书群机器人推送通知
- **全面集成**：实时监测、智策定时分析均支持Webhook推送
- **灵活配置**：
  - Web界面可视化配置，简单易用
  - 支持自定义关键词，匹配机器人安全设置
  - 可同时启用邮件和Webhook，双重保障
- **消息格式**：
  - 钉钉：精美Markdown格式，信息清晰
  - 飞书：交互式卡片消息，展示美观
- **智能推送**：
  - 实时监测：进场/止盈/止损实时提醒
  - 智策分析：每日板块策略精简摘要
  - 量化交易：自动下单执行通知
- **完整测试**：内置测试功能，一键验证配置
- **详细文档**：提供完整的配置指南和故障排查

<img width="1910" height="923" alt="Webhook配置界面" src="https://github.com/user-attachments/assets/webhook_config.png" />

## ✨历史更新
- **1011**：优化数据获取
- **1010**：新增港股分析支持、主力选股功能上线
- **1009**：增加Docker部署支持
- **1008**：增加批量分析功能
- **1006**：增加跟踪主力资金mcp、环境配置功能
- **1005**：增加股票监测功能、历史记录导入监测

## ✨ 功能特色

### 🎯 核心功能模块

#### 📊 股票分析
- **多维度分析**：技术面、基本面、资金面、风险管理、市场情绪
- **AI智能体团队**：6位专业分析师（技术、基本面、资金、风险、情绪、新闻）
- **三大市场支持**：A股、港股、美股全覆盖
- **完整分析流程**：数据获取→多智能体分析→团队讨论→最终决策→PDF报告

#### 🎯 智瞰龙虎（1017新增）
- **5位AI分析师**：游资行为、个股潜力、题材追踪、风险控制、首席策略
- **核心功能**：次日上涨股票推荐、游资追踪、题材识别、风险警示
- **使用场景**：短线交易、游资跟踪、题材炒作、风险规避

#### 🎯 智策板块（1015新增）
- **4位AI智能体**：宏观策略师、板块诊断师、资金流向分析师、市场情绪解码员
- **三维预测**：板块多空预测、板块轮动预测、板块热度排行
- **定时分析**：每日自动运行、邮件+Webhook推送、状态实时监控

#### 🎯 主力选股（1010新增）
- **智能选股**：基于主力资金流向，AI团队精选3-5只优质标的
- **数据来源**：问财前100名主力资金净流入股票
- **多维筛选**：市值范围、涨跌幅限制、财务指标
- **批量分析**：对主力资金净流入TOP 10/20/30/50只股票进行深度AI分析 ⭐️新增

#### 🔥 批量分析（1008新增）
- **双模式**：顺序分析 / 多线程并行
- **对比视图**：横向对比多只股票关键指标
- **智能筛选**：按评级、涨跌幅、信心度筛选

#### 🔍 实时监测（1005新增）
- **智能监测**：自动监控价格变动
- **关键位置提醒**：进场区间、止盈位、止损位
- **多种通知**：网页提醒 + 邮件 + Webhook

#### 🤖 量化交易（1006新增）
- **MiniQMT集成**：自动交易执行、仓位管理、风险控制
- **多种订单**：市价单、限价单、止损单

#### 📧 通知系统（1015增强）
- **Webhook通知**：钉钉、飞书群机器人推送
- **邮件通知**：QQ邮箱、163邮箱、Gmail支持
- **双重保障**：Webhook和邮件可同时使用

## 🚀 快速开始

### 部署方式选择

本系统支持两种部署方式：
- **🐳 Docker部署（推荐）**：一键启动，环境隔离，适合所有用户
- **💻 本地部署**：传统方式，适合开发者

---

## 🐳 方式一：Docker 部署（推荐）⭐️

### 优势
- ✅ 无需配置Python和Node.js环境
- ✅ 一键启动，开箱即用
- ✅ 环境隔离，不影响系统
- ✅ 跨平台支持（Windows/macOS/Linux）
- ✅ 自动重启，稳定可靠

### 前置要求
- Docker 20.10+
- Docker Compose 2.0+（推荐）
- DeepSeek API Key

### 快速开始

#### 1. 安装 Docker
- **Windows/macOS**: 下载安装 [Docker Desktop](https://www.docker.com/products/docker-desktop/)
- **Linux**: 
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
```

#### 2. 配置环境变量
```bash
# Windows (PowerShell)
Copy-Item .env.example .env

# Linux/macOS
cp .env.example .env
```

编辑 `.env` 文件，填入您的 DeepSeek API Key：
```env
DEEPSEEK_API_KEY=sk-your-actual-api-key-here
```

#### 3. 启动服务

**国内用户推荐**（使用国内镜像源，构建速度快6倍+）：
```bash
# 使用国内源版Dockerfile构建
docker build -f "Dockerfile国内源版" -t agentsstock1 .
docker run -d -p 8503:8501 -v $(pwd)/.env:/app/.env --name agentsstock1 agentsstock1
```

**标准构建方式**：
```bash
# 使用 Docker Compose（推荐）
docker-compose up -d

# 或使用标准 Dockerfile
docker build -t agentsstock1 .
docker run -d -p 8503:8501 -v $(pwd)/.env:/app/.env --name agentsstock1 agentsstock1
```

#### 4. 访问系统（为避免端口冲突，已将运行端口改为8503）
打开浏览器访问：http://localhost:8503

#### 5. 常用命令
```bash
# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down

# 重启服务
docker-compose restart
```

**📖 详细文档**：
- [DOCKER_DEPLOYMENT.md](docs/DOCKER_DEPLOYMENT.md) - Docker部署完整指南
- [DOCKER_CN_BUILD_GUIDE.md](docs/DOCKER_CN_BUILD_GUIDE.md) - 国内镜像源构建指南 ⭐ 推荐

---

## 💻 方式二：本地部署

### 1. 环境要求
- Python 3.8+(微软store或官网，推荐3.12)
- Node.js 16+ (微软store或官网，pywencai需要)
- 稳定的网络连接（大陆网络请关闭vpn）
- DeepSeek API Key

### 2. 安装依赖
创建激活虚拟环境（powershell）并安装依赖
```bash
python -m venv venv
.\venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

### 3. 配置API

#### 方法一：使用环境变量文件（推荐）
1. 复制环境变量模板文件：
```bash
# Windows (PowerShell)
Copy-Item .env.example .env

# 或者使用命令
cp .env.example .env
```

2. 编辑 `.env` 文件，设置您的配置（也可在前端web界面-环境配置中设置）：
```env
# DeepSeek API配置（必需）
DEEPSEEK_API_KEY=your_actual_deepseek_api_key_here

# Tushare配置（可选）- 作为降级数据源
TUSHARE_TOKEN=your_tushare_token       # 在 https://tushare.pro 注册获取

# 邮件通知配置（可选）- 用于实时监测和智策定时分析
EMAIL_ENABLED=false
SMTP_SERVER=smtp.qq.com
SMTP_PORT=587
EMAIL_FROM=your_email@qq.com
EMAIL_PASSWORD=your_authorization_code
EMAIL_TO=receiver@example.com

# Webhook通知配置（可选）⭐️ 新增 - 用于实时监测和智策定时分析
WEBHOOK_ENABLED=false
WEBHOOK_TYPE=dingtalk  # 或 feishu
WEBHOOK_URL=your_webhook_url_here
WEBHOOK_KEYWORD=股票  # 钉钉自定义关键词，飞书可留空

# MiniQMT量化交易配置（可选）
MINIQMT_ENABLED=false
MINIQMT_ACCOUNT_ID=your_account_id
MINIQMT_HOST=127.0.0.1
MINIQMT_PORT=58610
```

#### 方法二：设置系统环境变量
您也可以直接在系统环境变量中设置：
- 变量名：`DEEPSEEK_API_KEY`
- 变量值：您的API密钥

**注意**：环境变量文件的优先级高于系统环境变量。

### 4. 启动系统
```bash
.\venv\Scripts\Activate.ps1
python run.py
```
或者直接运行：
```bash
.\venv\Scripts\Activate.ps1
streamlit run app.py
```

### 5. 访问系统
打开浏览器访问：http://localhost:8501

---

## 📊 使用指南

### 股票代码格式
- **A股**：6位数字代码（如 000001, 600036, 600519, 000858）
- **港股**：1-5位数字代码（如 700, 00700, 9988, 01810）或带HK前缀（如 HK00700）
- **美股**：字母代码（如 AAPL, MSFT, GOOGL, TSLA, NVDA）

### 单个股票分析流程
1. 选择"单个分析"模式
2. 在输入框中输入股票代码
3. 选择要参与分析的分析师团队
4. 点击"开始分析"按钮
5. 等待AI分析师团队完成分析
6. 查看各维度分析报告
7. 阅读团队讨论结果
8. 获取最终投资决策

### 批量股票分析流程 ⭐️ 新增
1. **选择批量分析模式**
   - 点击"批量分析"单选按钮
   - 选择分析模式：顺序分析 或 多线程并行

2. **输入股票代码**
   - 支持多种格式：
     ```
     # 每行一个代码
     000001
     600036
     600519
     
     # 或逗号分隔
     000001, 600036, 600519
     
     # 或空格分隔
     000001 600036 600519
     ```

3. **配置分析参数**
   - 选择数据周期（1y, 6mo, 3mo, 1mo）
   - 选择要参与的分析师团队

4. **开始批量分析**
   - 点击"开始批量分析"按钮
   - 系统会实时显示分析进度
   - 每只股票的分析状态都会更新

5. **查看分析结果**
   - **对比表格模式**：
     - 横向对比所有股票的关键指标
     - 投资评级用颜色标识（绿色=买入，黄色=持有，红色=卖出）
     - 可按评级筛选
     - 可按涨跌幅、信心度、RSI等排序
   
   - **详细卡片模式**：
     - 从下拉列表选择要查看的股票
     - 查看完整的分析报告
     - 包含图表、各分析师意见、团队讨论、最终决策

6. **结果管理**
   - 所有分析结果自动保存到历史记录
   - 点击"清除结果"可清空当前批量分析结果
   - 失败的股票会单独列出，显示失败原因

### 批量分析使用技巧
- **建议数量**：一次分析不超过20只股票
- **模式选择**：
  - 3-5只股票：建议使用顺序分析，更稳定
  - 6只以上：建议使用多线程并行，更快速
- **注意事项**：
  - 多线程模式最多3个并发，避免API限流
  - 批量分析时间较长，请耐心等待
  - 可在历史记录中查看所有分析结果

### 智瞰龙虎榜分析使用流程 ⭐️ 1017全新上线
1. **进入智瞰龙虎**
   - 点击侧边栏"🎯 智瞰龙虎"按钮
   
2. **设置分析参数**
   - **分析模式**：选择"指定日期"或"最近N天"
   - **日期选择**：建议选择昨天的日期（龙虎榜数据T日更新）
   - **AI模型**：
     - **deepseek-chat**：速度快，8-12分钟完成
     - **deepseek-reasoner**：推理深入，12-18分钟完成
   
3. **开始分析**
   - 点击"🚀 开始分析"按钮
   - 系统自动执行：
     - 获取龙虎榜数据（10-30秒）
     - 保存数据到数据库
     - 5位AI分析师并行分析（8-15分钟）
     - 提取推荐股票
     - 生成分析报告

4. **查看分析结果**
   分析完成后，查看四个标签页：
   
   - **🎯 推荐股票**：
     - AI筛选的次日大概率上涨股票（TOP5-8）
     - 每只股票的详细推荐理由
     - 确定性评级（高/中/低）
     - 持有周期建议
   
   - **🤖 AI分析师报告**：
     - 游资行为分析师：游资操作特征和意图
     - 个股潜力分析师：潜力股挖掘和上涨逻辑
     - 题材追踪分析师：热点题材和龙头股
     - 风险控制专家：高风险股票和陷阱识别
     - 首席策略师：综合研判和最终建议
   
   - **📊 数据详情**：
     - 活跃游资TOP10
     - 资金净流入TOP20股票
     - 热门概念TOP20
   
   - **📈 可视化图表**：
     - 资金净流入柱状图
     - 概念分布饼图

5. **导出PDF报告**
   - 点击"📥 生成PDF"按钮
   - 等待生成（3-5秒）
   - 下载完整的龙虎榜分析报告

6. **查看历史报告** ⭐️ 增强版
   - 切换到"📚 历史报告"标签
   - 查看最近50条历史分析报告
   - 点击展开任意报告，可查看：
     - **报告摘要**：分析概要信息
     - **推荐股票**：完整的推荐股票列表
     - **AI分析师团队报告**：5位分析师的详细分析（可展开）
     - **AI评分排名**：TOP10股票的评分详情
     - **数据概况**：龙虎榜统计信息
   - 点击"📋 加载到分析页"按钮，可将历史报告重新加载到分析标签页
   - 切换到"📈 数据统计"标签，查看龙虎榜历史统计数据

7. **使用技巧**
   - **最佳分析时间**：交易日晚上18:00-21:00（龙虎榜数据已更新）
   - **重点关注**：确定性评级为"高"的推荐股票
   - **游资跟踪**：关注知名游资和多席位联合买入
   - **题材把握**：重点关注萌芽期和爆发期的题材
   - **风险控制**：严格执行止损位，避开风险股票
   - **仓位管理**：
     - 高确定性：30-40%
     - 中确定性：20-30%
     - 低确定性：10-15%

8. **注意事项**
   - ⚠️ AI分析仅供参考，不构成投资建议
   - ⚠️ 龙虎榜数据为T日数据，存在时间差
   - ⚠️ 游资操作灵活，可能快速撤离
   - ⚠️ 务必设置止损，控制风险
   - ⚠️ 市场有风险，投资需谨慎

### 智策板块分析使用流程 ⭐️ 全新功能
1. **进入智策板块**
   - 点击侧边栏"🎯 智策板块"按钮
   
2. **选择AI模型**
   - **deepseek-chat**：标准模型，速度快（2-3分钟）
   - **deepseek-reasoner**：推理增强模型，分析深度更高（3-5分钟）
   
3. **开始分析**
   - 点击"🚀 开始智策分析"按钮
   - 系统自动执行：
     - 获取市场数据（30秒）
     - 四位AI智能体并行分析（1.5-2分钟）
     - 综合研判（30秒）
     - 生成预测报告

4. **查看分析结果**
   分析完成后，查看四个标签页：
   
   - **📋 核心预测**：
     - 板块多空预测（看多/看空/中性）
     - 板块轮动预测（强势/潜力/衰退）
     - 板块热度排行（最热/升温/降温）
     - 策略总结（观点、机会、风险、策略）
   
   - **🤖 智能体分析**：
     - 宏观策略师报告
     - 板块诊断师报告
     - 资金流向分析师报告
     - 市场情绪解码员报告
   
   - **📊 综合研判**：
     - 团队综合讨论结果
     - 多维度分析整合
   
   - **📈 数据可视化**：
     - 板块多空信心度对比图
     - 板块热度分布图

5. **导出PDF报告**
   - 点击"📥 生成PDF报告"按钮
   - 等待生成（3-5秒）
   - 点击"💾 下载PDF"保存

6. **配置定时分析** ⭐️
   展开"⏰ 定时分析设置"：
   
   **步骤1：配置邮件/Webhook**
   - 方法A：在"⚙️ 环境配置" → "📢 通知配置"中设置
   - 方法B：编辑.env文件配置
   
   **步骤2：设置运行时间**
   - 选择每天运行时间（默认9:00）
   - 建议时间：
     - 盘前：8:00-8:30（制定当日策略）
     - 盘后：16:00-17:00（总结当日行情）
     - 晚间：21:00-22:00（深度研读分析）
   
   **步骤3：启动定时任务**
   - 点击"▶️ 启动定时任务"
   - 系统显示"✅ 定时任务已启动"
   - 每天自动运行并推送结果
   
   **步骤4：测试功能**
   - 点击"🔄 立即运行一次"测试
   - 检查邮箱/钉钉/飞书是否收到报告
   
   **步骤5：管理任务**
   - 查看运行状态和上次运行时间
   - 需要时可点击"⏹️ 停止定时任务"

7. **使用技巧**
   - **最佳使用时间**：盘前8:30-9:30或盘后15:30-20:00
   - **关注信心度**：≥8分为高信心，可重点关注
   - **结合轮动**：重点关注"潜力接力板块"，最佳布局时机
   - **热度判断**：升温板块有机会，降温板块注意风险
   - **四维共振**：宏观、基本面、资金、情绪共振时信号更强

8. **通知内容示例**
   
   **邮件/Webhook推送内容**：
   ```
   智策板块分析报告 - 2024-01-15 09:00
   
   📊 板块多空
   【看多】人工智能(8分)、新能源汽车(8分)、半导体(7分)
   【看空】地产开发(7分)
   
   🔄 潜力接力板块 ⭐ 重点关注
   • 半导体：关注突破信号
   • 军工：情绪升温，把握机会
   
   🌡️ 热度TOP3
   1. 人工智能 - 95分
   2. 新能源汽车 - 92分
   3. 半导体 - 88分
   
   💡 核心机会
   重点关注人工智能、新能源汽车产业链...
   ```

### 主力选股功能使用流程 ⭐️ 新增
1. **进入主力选股**
   - 点击侧边栏"🎯 主力选股"按钮
   
2. **设置筛选参数**
   - **起始日期**：选择区间开始日期（如"2025年7月23日"）
   - **市值范围**：
     - 最小市值：默认50亿（可调整）
     - 最大市值：默认5000亿（可调整）
   - **最大涨跌幅**：默认50%（过滤涨幅过高的股票）

3. **开始分析**
   - 点击"🚀 开始主力选股分析"按钮
   - 系统会自动：
     - 从问财获取前100名主力资金净流入股票
     - 按条件筛选（市值、涨跌幅）
     - AI分析师团队进行整体分析
     - 资深研究员精选3-5只优质标的

4. **查看分析结果**
   - **统计信息**：
     - 获取股票数：原始数据量
     - 筛选后：符合条件的股票数
     - 最终推荐：精选的优质标的数量
   
   - **AI分析师报告**（三个标签页）：
     - 💰 资金流向分析：主力资金动向、热点板块
     - 📊 行业板块分析：行业轮动、板块联动
     - 📈 财务基本面分析：盈利能力、成长性评估
   
   - **精选推荐**：
     - 展开查看每只推荐股票的详细信息
     - 推荐理由、关键指标、能力评分
   
   - **候选股票列表**：
     - 前100名股票完整列表
     - 按主力资金流向排序
     - 包含行业、资金流向、涨跌幅、市值、市盈率等

5. **导出报告**
   - 📄 **下载Markdown报告**：便于编辑和二次处理
   - 🌐 **下载HTML报告**：美观易读，可打印
   - 📊 **下载候选列表CSV**：Excel打开，便于筛选排序

6. **使用技巧**
   - **起始日期**：建议选择近3-6个月的日期
   - **市值范围**：中小盘（50-300亿）波动较大，大盘（300-5000亿）相对稳定
   - **涨跌幅限制**：建议30%-50%，避免追高
   - **查看调试信息**：展开"🔍 调试信息"查看实际获取的列名

### 结果解读
- **投资评级**：买入/持有/卖出
- **目标价位**：预期价格目标
- **操作建议**：具体交易策略
- **进出场位置**：关键价位点
- **止盈止损**：风险控制位置
- **风险提示**：主要风险因素

### 实时监测功能

#### 快速开始
1. 点击侧边栏"📊 实时监测"按钮
2. 在监测管理页面点击"添加监测股票"
3. 填写股票信息和监测参数
4. 点击"▶️ 启动监测"开始自动监控

#### 添加监测股票
**必填信息**：
- **股票代码**：6位A股代码或美股字母代码
- **股票名称**：便于识别
- **投资评级**：买入/持有/卖出

**监测参数**：
- **进场区间**：设置最小和最大价格
  - 当股票价格进入该区间时触发通知
  - 用于把握最佳买入时机
- **止盈位**：目标卖出价格
  - 价格达到或超过该值时提醒
  - 帮助锁定收益
- **止损位**：最大亏损价格
  - 价格跌破该值时立即提醒
  - 控制投资风险
- **检查间隔**：30-300秒
  - 监测频率，建议60秒以上
  - 避免过于频繁的API调用

#### 管理监测股票
**查看功能**：
- 📊 实时价格显示
- 📈 涨跌幅展示
- ⏰ 最后检查时间
- 🔔 通知状态

**操作按钮**：
- 🔄 **更新**：手动刷新当前价格
- ✏️ **编辑**：修改监测参数
- 🔔/🔕 **通知开关**：启用/禁用通知
- 🗑️ **删除**：移除监测

**批量操作**：
- ▶️ 启动监测：开始后台自动监控所有股票
- ⏹️ 停止监测：暂停监控服务
- 🔄 刷新状态：更新显示信息

#### 通知系统

**网页通知**：
- 自动在界面显示提醒
- 实时查看通知历史
- 支持标记已读和清空

**邮件通知配置**：

1. **编辑.env文件**：
```env
EMAIL_ENABLED=true
SMTP_SERVER=smtp.qq.com
SMTP_PORT=587
EMAIL_FROM=your_email@qq.com
EMAIL_PASSWORD=your_authorization_code
EMAIL_TO=receiver@example.com
```

2. **获取邮箱授权码**：
   - **QQ邮箱**：设置 → 账户 → POP3/IMAP/SMTP → 生成授权码
   - **163邮箱**：设置 → POP3/SMTP/IMAP → 开启服务 → 设置授权密码
   - **Gmail**：开启两步验证 → 生成应用专用密码

3. **测试邮件配置**：
   - 进入"通知管理"区域
   - 点击"📧 发送测试邮件"
   - 检查收件箱（含垃圾箱）

**Webhook通知配置** ⭐️ 新增：

1. **方法一：Web界面配置（推荐）**
   - 进入"⚙️ 环境配置" → "📢 通知配置"
   - 勾选"启用Webhook通知"
   - 选择类型（钉钉/飞书）
   - 填写Webhook URL和关键词
   - 点击"💾 保存配置"

2. **方法二：编辑.env文件**
```env
WEBHOOK_ENABLED=true
WEBHOOK_TYPE=dingtalk
WEBHOOK_URL=https://oapi.dingtalk.com/robot/send?access_token=xxxxx
WEBHOOK_KEYWORD=股票
```

3. **创建钉钉机器人**：
   - 钉钉群 → 设置 → 智能群助手 → 添加机器人 → 自定义
   - 安全设置：自定义关键词（如：股票、分析）
   - 复制Webhook地址到配置中

4. **创建飞书机器人**：
   - 飞书群 → 设置 → 群机器人 → 添加机器人 → 自定义机器人
   - 设置名称：AI股票分析系统
   - 复制Webhook地址到配置中

5. **测试配置**：
   - 进入"📊 实时监测" → "🔔 通知管理"
   - 点击"📱 发送测试Webhook"
   - 检查钉钉/飞书群是否收到消息

**通知触发条件**：
- ✅ 价格进入进场区间 → 进场提醒
- ✅ 价格达到止盈位 → 止盈提醒
- ✅ 价格跌破止损位 → 止损提醒
- ✅ 智策定时分析 → 板块策略推送

#### 使用技巧

**参数设置建议**：
- **进场区间**：根据技术分析设定支撑位和阻力位
- **止盈位**：建议设置10-20%的盈利目标
- **止损位**：建议设置5-10%的止损线
- **检查间隔**：
  - 长线投资：180-300秒
  - 短线交易：30-60秒

**监测策略**：
1. 分析后添加到监测列表
2. 设置合理的进场区间等待买入信号
3. 买入后调整为止盈/止损监测
4. 收到通知后及时决策

**注意事项**：
- ⚠️ 监测间隔不要设置太短，避免频繁API调用
- ⚠️ 邮件通知有延迟，不适用于高频交易
- ⚠️ 定期检查监测服务运行状态
- ⚠️ 及时处理触发的通知，避免错过时机

## 🏗️ 系统架构

```
AI股票分析系统
├── app.py                          # Streamlit主界面
├── stock_data.py                   # 股票数据获取模块
├── deepseek_client.py              # DeepSeek API客户端
├── ai_agents.py                    # AI智能体分析模块
├── monitor_manager.py              # 监测管理界面
├── monitor_service.py              # 监测服务后台
├── monitor_db.py                   # 监测数据库管理
├── notification_service.py         # 通知服务（邮件/Webhook/界面）⭐️
├── config_manager.py               # 配置管理模块 ⭐️
├── miniqmt_interface.py            # MiniQMT量化交易接口 ⭐️
├── longhubang_data.py              # 智瞰龙虎数据获取模块 ⭐️ 1017新增
├── longhubang_db.py                # 智瞰龙虎数据库管理 ⭐️ 1017新增
├── longhubang_agents.py            # 智瞰龙虎AI分析师团队 ⭐️ 1017新增
├── longhubang_engine.py            # 智瞰龙虎分析引擎 ⭐️ 1017新增
├── longhubang_pdf.py               # 智瞰龙虎PDF报告生成 ⭐️ 1017新增
├── longhubang_ui.py                # 智瞰龙虎界面模块 ⭐️ 1017新增
├── sector_strategy_data.py         # 智策数据采集模块 ⭐️
├── sector_strategy_agents.py       # 智策AI智能体团队 ⭐️
├── sector_strategy_engine.py       # 智策分析引擎 ⭐️
├── sector_strategy_scheduler.py    # 智策定时任务调度器 ⭐️
├── sector_strategy_ui.py           # 智策界面模块 ⭐️
├── sector_strategy_pdf.py          # 智策PDF报告生成 ⭐️
├── main_force_selector.py          # 主力选股数据获取
├── main_force_analysis.py          # 主力选股AI分析
├── main_force_ui.py                # 主力选股界面
├── main_force_pdf_generator.py     # 主力选股报告生成
├── pdf_generator.py                # PDF报告生成
├── database.py                     # 分析记录数据库
├── config.py                       # 配置文件
├── requirements.txt                # 依赖包列表
├── run.py                          # 启动脚本
├── Dockerfile                      # Docker镜像构建文件 🐳
├── docker-compose.yml              # Docker编排配置文件 🐳
├── .dockerignore                   # Docker构建忽略文件 🐳
└── DOCKER_DEPLOYMENT.md            # Docker部署详细文档 🐳
```

### 核心模块说明

#### 📈 股票数据模块 (stock_data.py)
- 支持A股和美股数据获取
- 集成yfinance和akshare数据源
- 自动计算技术指标（MA、RSI、MACD、KDJ等）
- 获取详细财务数据（三大报表+13+财务指标）
- 数据清洗和格式化

#### 🤖 AI智能体模块 (ai_agents.py)
- 多个专业分析师AI角色
- 并行分析处理
- 团队讨论机制
- 最终决策生成
- 财务数据深度解读

#### 🔗 API客户端 (deepseek_client.py)
- DeepSeek API封装
- 智能对话管理
- 错误处理和重试
- 响应格式解析
- 支持多模型切换

#### 🔍 监测管理模块 (monitor_manager.py)
- 股票监测管理界面
- 添加/编辑/删除监测
- 卡片式展示
- 搜索和筛选功能
- 通知历史管理

#### ⚙️ 监测服务模块 (monitor_service.py)
- 后台监测线程
- 定时价格检查
- 触发条件判断
- 自动通知发送
- 启动/停止控制

#### 💾 监测数据库 (monitor_db.py)
- SQLite数据持久化
- 监测股票表
- 价格历史表
- 通知记录表
- CRUD操作接口

#### 📧 通知服务模块 (notification_service.py) ⭐️ 增强
- **邮件通知**：发送详细分析报告
- **Webhook通知** ⭐️ 新增：
  - 钉钉群机器人推送（Markdown格式）
  - 飞书群机器人推送（交互式卡片）
  - 自定义关键词支持
  - 自动错误处理和重试
- **网页通知**：界面实时提醒
- **多平台支持**：QQ邮箱/163邮箱/Gmail/钉钉/飞书
- **通知历史管理**：完整记录和查询
- **配置测试功能**：一键测试邮件和Webhook

#### 🎯 智瞰龙虎榜分析模块 ⭐️ 1017全新上线
**longhubang_data.py**
- StockAPI龙虎榜接口对接
- 游资上榜交割单数据获取
- 支持单日/多日数据获取
- 数据解析和统计分析
- 格式化输出（适配AI分析）

**longhubang_db.py**
- SQLite数据库管理
- 龙虎榜记录表（完整历史数据）
- 分析报告表（AI分析结果）
- 股票追踪表（推荐股票追踪）
- 活跃游资/热门股票统计

**longhubang_agents.py**
- 五位AI分析师实现
- 🎯 游资行为分析师：游资操作特征分析
- 📈 个股潜力分析师：次日上涨股票挖掘（核心）
- 🔥 题材追踪分析师：热点题材识别
- ⚠️ 风险控制专家：高风险股票识别
- 👔 首席策略师：综合研判和最终决策

**longhubang_engine.py**
- 龙虎榜综合分析引擎
- 数据获取→存储→分析→报告完整流程
- 推荐股票提取和评级
- 历史记录管理

**longhubang_ui.py**
- 智瞰龙虎主界面
- 分析参数设置（日期/模型）
- 实时进度显示
- 四个结果标签页（推荐/报告/数据/图表）
- 历史报告查询
- 数据统计展示

**longhubang_pdf.py**
- PDF报告生成（基于ReportLab）
- 龙虎榜分析报告
- 推荐股票清单
- AI分析师报告集成
- 专业排版设计

#### 🎯 智策板块分析模块 ⭐️ 全新功能
**sector_strategy_data.py**
- AKShare数据采集和整合
- 行业/概念板块行情数据
- 主力资金流向数据（今日/3日/5日/10日）
- 北向资金历史趋势
- 东方财富财经快讯（150条）
- 市场统计数据（涨跌家数、涨停跌停）

**sector_strategy_agents.py**
- 四位AI智能体实现
- 🌐 宏观策略师：政策和新闻分析
- 📊 板块诊断师：板块走势和估值分析
- 💰 资金流向分析师：资金流动分析
- 📈 市场情绪解码员：情绪量化分析

**sector_strategy_engine.py**
- 多智能体协同引擎
- 并行分析处理
- 综合研判机制
- 三维预测生成（多空/轮动/热度）

**sector_strategy_scheduler.py** ⭐️
- 定时任务调度（基于schedule库）
- 后台daemon线程运行
- 手动触发分析
- 状态监控和查询
- 邮件+Webhook自动推送
- 错误通知处理

**sector_strategy_ui.py**
- 智策板块主界面
- AI模型选择
- 分析进度显示
- 四个结果标签页展示
- 定时分析设置面板
- PDF报告导出功能

**sector_strategy_pdf.py**
- PDF报告生成（基于ReportLab）
- 完整分析内容格式化
- 中文字体支持
- 专业排版设计

#### 🎯 主力选股模块 ⭐️ 新增
**main_force_selector.py**
- 问财数据获取（主力资金净流入）
- 多维度筛选（市值、涨跌幅）
- 智能列名匹配
- 数据格式化和清洗

**main_force_analysis.py**
- AI分析师团队协作
- 整体数据分析（100只股票）
- 资金流向分析
- 行业板块分析
- 财务基本面分析
- 资深研究员决策

**main_force_ui.py**
- 参数配置界面
- 分析进度显示
- 结果可视化展示
- 报告导出功能

**main_force_pdf_generator.py**
- Markdown报告生成
- HTML报告生成
- CSV数据导出
- 美观格式化输出

#### 🤖 量化交易模块 (miniqmt_interface.py) ⭐️ 新增
- MiniQMT接口对接
- 自动交易执行
- 仓位管理
- 风险控制
- 订单管理
- 持仓监控
- 预留接口实现

#### 📄 PDF生成模块 (pdf_generator.py)
- 专业分析报告生成
- 中文字体支持
- 完整分析内容
- 一键下载功能

#### 🎨 前端界面 (app.py)
- 现代化渐变UI设计
- 响应式布局
- 三大功能模块（分析/监测/历史）
- 实时数据可视化
- 交互式操作
- 美观的动画效果

## 📋 技术特性

### 数据源
- **美股数据**：Yahoo Finance (yfinance)
- **A股数据**：AKShare免费接口
- **TDX本地数据源**：通达信TDX API（本地化部署，响应<50ms，无限制）⭐ 2025-11-04 NEW
- **主力资金数据**：问财（pywencai）- 主力选股功能 ⭐️
- **季报数据**：问财（pywencai）- 财务数据补充 ⭐️
- **技术指标**：TA-Lib技术分析库
- **降级机制**：TDX → Tushare → AKShare 多层数据源保障

### AI模型
- **语言模型**：DeepSeek Chat API
- **分析框架**：多智能体协作
- **决策逻辑**：综合评分机制

### 可视化
- **图表库**：Plotly交互式图表
- **K线图**：蜡烛图with技术指标
- **指标图**：RSI、MACD、布林带等

### 性能优化
- **数据缓存**：Streamlit缓存机制
- **异步处理**：并行分析提升效率
- **错误处理**：完善的异常处理机制

## ⚙️ 高级配置

### API配置
```env
# .env 文件
DEEPSEEK_API_KEY=your_api_key
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
```

**重要提示**：
- 请将 `.env.template` 复制为 `.env` 文件
- 在 `.env` 文件中填写实际的API密钥
- 不要将 `.env` 文件提交到版本控制系统

### 数据配置
```python
DEFAULT_PERIOD = "1y"      # 默认数据周期
DEFAULT_INTERVAL = "1d"    # 默认数据间隔
```

### 系统参数
- **缓存时间**：300秒（5分钟）
- **API超时**：30秒
- **最大重试**：3次

## 🛠️ 故障排除

### 常见问题

1. **API Key错误**
   - 检查.env文件中的DEEPSEEK_API_KEY设置
   - 确保.env文件存在且格式正确
   - 确保API Key有效且有足够余额

2. **股票数据获取失败**
   - 检查网络连接
   - 确认股票代码格式正确（A股6位数字，美股字母代码）
   - 可能是数据源临时不可用，稍后重试

3. **财务数据获取失败**
   - 部分新股可能没有完整财务数据
   - 网络问题可能导致数据获取超时
   - 系统会自动处理，继续进行其他分析

4. **依赖包安装失败**
   - 使用 `pip install -r requirements.txt`
   - 如有问题，尝试手动安装单个包
   - 确保Python版本为3.8+

5. **页面加载缓慢**
   - 首次运行需要下载数据，请耐心等待
   - 系统有5分钟缓存，重复查询会更快
   - 财务数据获取较慢，约需10-20秒

6. **分析过程中出错**
   - 检查网络连接是否稳定
   - 查看终端输出的详细错误信息
   - 尝试重新启动应用

7. **MiniQMT连接失败**
   - 确认MiniQMT客户端已启动
   - 检查账户已登录
   - 验证账户ID配置正确
   - 确认网络连接正常
   - 查看 `docs/MINIQMT_INTEGRATION_GUIDE.md` 详细指南

8. **量化交易未执行**
   - 确认量化功能已启用
   - 检查MiniQMT连接状态
   - 验证监测服务是否运行
   - 查看通知记录中的错误信息
   - 确认交易时间在交易日内

9. **Docker部署问题** 🐳
   - **容器启动失败**：
     - 检查Docker是否正常运行：`docker ps`
     - 查看容器日志：`docker-compose logs -f`
     - 确认.env文件已正确配置
   - **端口被占用**：
     - 修改docker-compose.yml中的端口映射（如改为8502:8501）
   - **无法访问网页**：
     - 确认容器正在运行：`docker ps`
     - 检查防火墙设置
     - 尝试访问：http://localhost:8501
   - **数据库权限问题**（Linux/macOS）：
     - 修改数据库文件权限：`chmod 666 *.db`
   - **Node.js相关错误**：
     - 容器内已集成Node.js环境，无需额外配置
     - 进入容器检查：`docker exec -it agentsstock1 bash`
   - **详细文档**：查看 `docs/DOCKER_DEPLOYMENT.md` 获取完整的故障排除指南

10. **Webhook通知问题** ⭐️ 新增
   - **未收到Webhook消息**：
     - 检查 `WEBHOOK_ENABLED=true` 是否已设置
     - 验证Webhook URL是否完整正确
     - 确认机器人未被移出群聊
     - 检查网络连接是否正常
   - **钉钉关键词不匹配（错误码310000）**：
     - 确认机器人安全设置中的关键词
     - 在.env中设置 `WEBHOOK_KEYWORD=股票`（与机器人设置一致）
     - 或添加关键词：股票、分析、智策、监测
   - **飞书消息发送失败**：
     - 确认选择 `WEBHOOK_TYPE=feishu`
     - 检查Webhook URL是否为飞书格式
     - 飞书不需要关键词，可设置 `WEBHOOK_KEYWORD=""`
   - **消息格式异常**：
     - 确认选择了正确的Webhook类型（钉钉/飞书）
     - 重新保存配置并重启应用
   - **测试Webhook**：
     - 进入"📊 实时监测" → "🔔 通知管理"
     - 点击"📱 发送测试Webhook"验证配置
     - 查看终端日志了解详细错误信息
   - **详细文档**：查看 `docs/Webhook通知配置指南.md` 获取完整配置教程

11. **TDX数据源问题** ⭐ 2025-11-04 NEW
   - **TDX服务无法访问**：
     - 检查TDX Docker容器是否运行：`docker ps | grep tdx`
     - 测试接口可用性：`curl "http://localhost:8080/api/quote?code=000001"`
     - 检查防火墙设置（确保8080端口开放）
     - 修改`.env`中的`TDX_BASE_URL`为正确的IP地址
   - **TDX数据源未启用**：
     - 确认`.env`中已配置：`TDX_ENABLED=true`
     - 确认`smart_monitor_tdx_data.py`文件存在
     - 重启应用生效
   - **频繁降级到其他数据源**：
     - 系统会自动降级到AKShare，无需干预
     - 如频繁降级，检查TDX服务状态
     - 查看日志：`docker logs tdx-api`
   - **详细文档**：
     - [TDX数据源快速配置.md](docs/TDX数据源快速配置.md)
     - [TDX数据源集成完成说明.md](docs/TDX数据源集成完成说明.md)

12. **智策板块分析问题** ⭐️ 全新功能
   - **数据获取失败**：
     - 检查网络连接是否稳定
     - AKShare数据源可能暂时不可用，稍后重试
     - 查看终端日志确认具体错误信息
   - **AI分析超时或失败**：
     - 检查DeepSeek API Key是否有效
     - 确认API余额充足
     - deepseek-reasoner模型较慢（3-5分钟），请耐心等待
     - 可切换到deepseek-chat模型（2-3分钟）
   - **定时任务未运行**：
     - 确认程序持续运行（本地部署不要关闭窗口）
     - 检查定时任务状态是否显示"✅ 运行中"
     - 验证系统时间是否正确
     - 点击"🔄 立即运行一次"测试
   - **邮件/Webhook未收到**：
     - 检查通知配置是否完整（邮箱或Webhook）
     - 使用"📧 测试邮件"或"📱 测试Webhook"验证
     - 查看垃圾邮件箱
     - 查看终端日志确认发送状态
   - **PDF生成失败**：
     - 确认已安装reportlab库：`pip install reportlab`
     - 检查系统是否有足够磁盘空间
     - 查看终端错误信息
   - **ModuleNotFoundError: schedule**：
     - 安装依赖：`pip install schedule`
     - 或：`.\venv\Scripts\pip.exe install schedule`
   - **详细文档**：
     - [智策板块使用指南.md](docs/智策板块使用指南.md)
     - [智策定时分析使用指南.md](docs/智策定时分析使用指南.md)
     - [智策功能总览.md](docs/智策功能总览.md)

### 日志调试
系统运行时会在控制台输出详细日志，可用于问题诊断。如遇到错误，请查看终端输出。

**Docker部署日志查看**：
```bash
# 实时查看日志
docker-compose logs -f

# 或查看特定容器日志
docker logs -f agentsstock1
```

### 相关文档

**TDX数据源文档** ⭐ 2025-11-04 NEW：
- [TDX数据源快速配置.md](docs/TDX数据源快速配置.md) - TDX本地化数据源配置指南
- [TDX数据源集成完成说明.md](docs/TDX数据源集成完成说明.md) - TDX集成技术说明
- [TDX API项目地址](https://github.com/oficcejo/tdx-api) - 通达信API项目

**通知系统文档** ⭐️：
- [Webhook通知配置指南.md](docs/Webhook通知配置指南.md) - Webhook完整配置教程
- [Webhook功能完成说明.md](docs/Webhook功能完成说明.md) - Webhook功能详细说明
- [Webhook自定义关键词功能说明.md](docs/Webhook自定义关键词功能说明.md) - 关键词配置指南
- [邮件配置指南.md](docs/邮件配置指南.md) - 邮件通知配置

**智策板块分析文档** ⭐️：
- [智策功能总览.md](docs/智策功能总览.md) - 智策系统全景介绍
- [智策板块使用指南.md](docs/智策板块使用指南.md) - 完整使用教程
- [智策板块快速开始.md](docs/智策板块快速开始.md) - 5分钟快速上手
- [智策定时分析使用指南.md](docs/智策定时分析使用指南.md) - 定时分析详细指南
- [智策定时分析功能完成说明.md](docs/智策定时分析功能完成说明.md) - 功能详细说明
- [智策定时分析部署清单.md](docs/智策定时分析部署清单.md) - 部署步骤和故障排查
- [智策定时分析更新日志.md](docs/智策定时分析更新日志.md) - 版本历史

**持仓定时分析文档** ⭐️：
- [PORTFOLIO_USAGE.md](docs/PORTFOLIO_USAGE.md) - 持仓分析完整使用指南
- [MULTI_SCHEDULE_GUIDE.md](docs/MULTI_SCHEDULE_GUIDE.md) - 多定时配置指南
- [UNIFIED_ANALYSIS_SPEC.md](docs/UNIFIED_ANALYSIS_SPEC.md) - 统一调用规范

**智瞰龙虎文档** ⭐️：
- [LONGHUBANG_BATCH_ANALYSIS.md](docs/LONGHUBANG_BATCH_ANALYSIS.md) - 批量分析使用指南
- [智瞰龙虎功能说明.md](docs/智瞰龙虎功能说明.md) - 功能详细说明
- [智瞰龙虎快速开始.md](docs/智瞰龙虎快速开始.md) - 快速上手指南

**其他功能文档**：
- [环境配置功能说明.md](docs/环境配置功能说明.md) - 完整环境配置说明
- [环境配置快速指南.md](docs/环境配置快速指南.md) - 快速配置参考
- [主力选股使用指南.md](docs/主力选股使用指南.md) - 主力选股功能
- [量化交易快速指南.md](docs/量化交易快速指南.md) - MiniQMT集成指南
- [DOCKER_DEPLOYMENT.md](docs/DOCKER_DEPLOYMENT.md) - Docker部署详细文档
- [QUICK_START.md](docs/QUICK_START.md) - 快速开始指南
- [UPDATE_LOG.md](docs/UPDATE_LOG.md) - 功能更新日志

### 错误报告
如发现bug，请查看 `BUGFIX.md` 文件了解已知问题和解决方案。

## 📜 免责声明

本系统仅供学习和研究使用，不构成投资建议。股票投资有风险，入市需谨慎。使用本系统进行投资决策的风险由用户自行承担。

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License

---

**享受AI驱动的智能股票分析体验！** 🚀📈任何疑问请留言或联系ws3101001@126.com

**技术支持：山东科技大学 于舒馨**
